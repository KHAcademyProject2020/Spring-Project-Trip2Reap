<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
    <select id="memberLogin" resultMap="memberResultSet">
        select *
        from member
        where member_id=#{memberId}
              and m_status='Y'
              and m_category='member'
    </select>
    <resultMap type="Member" id="memberResultSet">
        <id column="MEMBER_ID" property="memberId" />
        <result column="MEMBER_PWD" property="memberPwd" />
        <result column="MEMBER_NAMES" property="memberName" />
        <result column="NICKNAME" property="nickName" />
        <result column="GENDER" property="gender" />
        <result column="PHONE" property="phone" />
        <result column="MEMBER_EMAIL" property="email" />
        <result column="M_CATEGORY" property="mCategory" />
        <result column="M_STATUS" property="mStatus" />
    </resultMap>
    
    <select id="kakaoMemberCheck" resultType="_int">
        select count(*)
        from member
        where member_id=#{memberId} AND m_category='kakao'
    </select>
    
    <insert id="kakaoMemberInsert">
        insert into member
        values (#{memberId},null,null,#{nickName},null,null,null,'kakao',default )
    </insert>
    
    <select id="naverMemberCheck" resultType="_int">
        select count(*)
        from member
        where member_id=#{memberId} AND m_category='naver'
    </select>
    
    <insert id="naverMemberInsert">
        insert into member
        values (#{memberId},null,null,#{nickName},null,null,null,'naver',default )
    </insert>
    
    <update id="deleteMember">
        update member
        set m_status = 'N'
        where member_id=#{memberId} and m_category='member'
    </update>
    
    <delete id="deleteMemberOther">
        delete from member
        where member_id=#{memberId}
    </delete>
    
    <select id="memberCheck" resultType="_int">
        select count(*)
        from member
        where member_id=#{memberId}
    </select>
    
    <select id="nicknameCheck" resultType="_int">
        select count(*)
        from member
        where nickname=#{nickname}
    </select>
    
    <select id="checkEmail" resultType="_int">
        select count(*)
        from certification
        where email=#{email}
    </select>
    
    <select id="phoneCheck" resultType="_int">
        select count(*)
        from member
        where phone=#{phone}
    </select>
    
    <update id="ranNumCheckUpdate">
        update certification
        set randomkey=#{randomKey}
        where email=#{email}
    </update>
    
    <insert id="ranNumCheck">
        insert into certification
        values (#{email},#{randomKey})
    </insert>
    
    <insert id="insertMember">
        insert into member
        values (#{memberId},#{memberPwd},#{memberName},#{nickName},#{gender},#{phone},#{email},'member',DEFAULT )
    </insert>
    
    <select id="searchIdPhone" resultMap="memberResultSet">
        select member_id, member_names
        from member
        where member_names=#{memberName} and phone=#{phone} and m_status = 'Y'
    </select>
    
    <select id="searchIdEmail" resultMap="memberResultSet">
        select member_id, member_names
        from member
        where member_names=#{memberName} and member_email=#{email} and m_status = 'Y'
    </select>
    
    <select id="searchPwdEmail" resultMap="memberResultSet">
        select member_id, member_names
        from member
        where member_id=#{memberId} and member_email=#{email} and m_status = 'Y'
    </select>
    
    <update id="updatePwd">
        update member
        set member_pwd=#{memberPwd}
        where member_id=#{memberId} and m_category='member'
    </update>
    
    <update id="updateMember">
        update member
        set member_pwd=#{memberPwd}, member_names=#{memberName}, nickname=#{nickName}, member_email=#{email}, phone=#{phone}, gender=#{gender}
        where member_id=#{memberId} and m_category='member'
    </update>
    
    <select id="selectMyTravel" resultType="_int">
        select count(*)
        from mytravel
        where bo_no=#{boNo} and member_id=#{memberId}
    </select>
    
    <insert id="insertMyTravel">
        insert into mytravel
        values (#{boNo},#{memberId})
    </insert>
    
    <select id="selectTravelList" resultMap="travelResultSet">
        select bo_no, b.bo_title, b.bo_Tag, t.tr_theme, i.change_name
        from mytravel m
             join board b using(bo_no)
             join travel t using(bo_no)
             join img_file i using(bo_no)
        where m.member_id=#{memberId}
    </select>
    
    <resultMap type="MyTravel" id="travelResultSet">
        <id column="bo_no" property="boNo"></id>
        <result column="bo_title" property="bo_title"/>
        <result column="bo_Tag" property="bo_Tag"/>
        <result column="tr_theme" property="tr_theme"/>
        <result column="change_name" property="change_name"/>
    </resultMap>

</mapper>
